<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Morry's Blog]]></title>
  <link href="http://sparkmorry.github.io/atom.xml" rel="self"/>
  <link href="http://sparkmorry.github.io/"/>
  <updated>2014-04-07T12:54:15+08:00</updated>
  <id>http://sparkmorry.github.io/</id>
  <author>
    <name><![CDATA[Mengli Xia]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Flask-Peewee]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/04/05/flask-peewee/"/>
    <updated>2014-04-05T12:33:52+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/04/05/flask-peewee</id>
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;发现自己这段时间越来越浮躁起来，总是赶着时间完成项目，好久没有安静下来研究一些什么东西了。一本小说都看了一个月才看完，第一张不知道拿起放下看了多少遍，趁着坐火车的时间才看了下来，更别说画画了。前几天接到校友会组织创业大赛的一个网站，顺便要帮忙写个后台，因为正好室友实验室课题组要建个主页，也要做个简单的发布系统让她后续好简单点发布。想想功能也简单，就想顺手用最熟悉的框架flask做了吧，虽然知道用flask来作这种东西真是有点作死的节奏。写的时候就觉得跟当时学flask时候的心境真的相差太多，真是特别怀念当年天天泡图书馆的日子。也发现了现在人的审美也慢慢提高，对设计和体验也越来越在乎，好看的网站越来越多，所以很多早几年拿wordpress或者直接拖模版的网页已经让人越来越不能忍了。正好赶上了网页换代的好时代，这样简单的活光在校内的需求都这么大，就想自己顺便琢磨琢磨把整个系统完善一下，尽量以后可以多复用一点。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;先总结一下最近研究下来几个插件：</p>

<ol>
<li><a href="http://ckeditor.com/">CKEditor</a></li>
<li><a href="flask-admin.org">Flask-Admin</a>(虽然最后没有用成功)</li>
<li><a href="https://github.com/coleifer/flask-peewee/">Flask-Peewee</a></li>
</ol>


<p>本来是打算用熟悉点的SQLAlchemy＋Admin直接做后台操作的，但是因为Admin的templates实在无法override（也不知道问题到底出在哪了，以后再研究一下），碰巧发现了peewee，真是很轻量级又很赞的组合，直接用peewee-orm可以做好数据库，后来发现用的居然就是SQLAlchemy的内核，不过api感觉简单好用更多。后台操作的用法和Flask-Admin基本差不多，最重要的是example的代表性很好，对flask项目的模块管理又重新学习了一下。</p>

<p>作为一个前端，当然最重要的还是对CKEditor的学习啦，在这里还是赞一下CKEditor4的改版ui，真是很清新。上手很快，基本就是把存成在html格式放在数据库里，提取信息的问题上花时间搜索的有点多，结果居然在django的讨论帖上发现直接autoescaping off就行了。可能django和flask用的html渲染差不多都是jinja，所以也比较通用。后来查了一下应该也是可以直接通过js的方法来反转义的，就是一些标签的转义而已。还有没解决好的问题就是图片上传和浏览的问题，可能还得用上ckfinder，过几天也得好好研究一下源码。</p>

<p>代码库直接挂在<a href="https://github.com/sparkmorry/zaec">github-zaec</a>上了，学长说交东西不要太快，最好等deadline前几天再给人家，不然老是会被要求修改的（哈哈，真是太机智了）。等过几天，再慢慢把这个系统完善一下，尽量做成一个简单的cms。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript Function]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/26/javascript-function/"/>
    <updated>2014-02-26T17:18:30+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/26/javascript-function</id>
    <content type="html"><![CDATA[<p>It took me days to really understand what a closure is in javascript, and finally I have grokked the core concept. And here are some share to whom is new to the language like me. And this article is for some basic concepts about javascript functions, which is very important when learning the closure.</p>

<p>It is a little hard to get the concept by the definition. I have been reading articles and books these days to understand how javascript function works, which seems so different from other languages like C, Python, etc. The more you get, the more confused you are, as people have really different understandings. Some of them are confusing, and some of them are misunderstanding or even wrong, as everyone makes mistakes. And finally I come to the idea that the best way to learn it is typing the code to you browser and debug to see how it works. It really helps alot. Let me explore it a little bit deeper by the examples.</p>

<p>We first started by some basic concept about javascript function:</p>

<h3>Definition</h3>

<p>There are 3 ways to define a function in javascript:</p>

<ol>
<li>function funcname(para1, para2){ … }</li>
<li>var funcname = function(para1, para2){ … }</li>
<li>var funcname = Function(para1, para2, &ldquo;…&rdquo;);</li>
</ol>


<p>By using the first one, you are creating a function with a name funcname, which is actually a pointer to the function. It is called function <strong>declaration</strong>. By using the second two, you are creating a function which is widely know as a anonymous function. It is called a function <strong>expression</strong>, which returns a pointer, and you can assign it to a variable funcname so as to call(invoke) it. The diffrence between them is how the browser loads them into the execution context:</p>

<p><strong>function declarations loads before any code is executed.</strong></p>

<p><strong>While function expressions loads only when the interpreter reaches that line of code.</strong></p>

<p>By declaring a function, you can call it before you have actually defined. That is because javascript has the mechanisim to raise the function decalration before any code is excuted, while you cannot do that in the second situation.</p>

<h3>Invocation</h3>

<p>The invocation is really different from a difinition, especially in these scrtipt language. A function is never executed until it is invoked. As metioned in <a href="http://book.douban.com/subject/2994925/">Javascript: The Good Parts</a>, there are 4 paterns of invovation in javascript:</p>

<ol>
<li>The Method Invocation Pattern</li>
<li>The Function Invocation Pattern</li>
<li>The Constructor Invocation Pattern</li>
<li>The Apply Invocation Pattern</li>
</ol>


<p>The difference between them is how the special varible <strong>this</strong> is initialized.</p>

<h4>The method invocation pattern</h4>

<p>If an invocation expression con- tains a refinement (that is, a . dot expression or [subscript] expression), it is invoked as a method. A common patern is like:</p>

<pre><code>var num = Myobject.method(para1, para2);
</code></pre>

<p>In this way, the bonus parameter <strong>this</strong> is bound to the object Myobject. That is when you alert(this) inside the function, it will alert Object Myobject.</p>

<h4>The function invocation pattern</h4>

<p>When a function is not the property of an object, then it is invoked as a function:</p>

<pre><code> var sum = add(3, 4);    // sum is 7
</code></pre>

<p>Most of the function are invoked in this way. In this case, the bonus parameter <strong>this</strong> is bound to the global object. That is when you alert(this) inside the function, it will alert Object Global(or mostly the Window object in a browser).</p>

<h4>The constructor invocation pattern</h4>

<p>If a function is invoked with the new prefix, then a new object will be created with a hidden link to the value of the function’s prototype member, and this will be bound to that new object. That is what confused me at the first glance, about how a constructor works in javascript which is made by a function without a class being defined. The author gave a clear answer that javascript is a prototypal inheritance language while offers an object-making syntax that is reminiscent of the classical languages.</p>

<h4>The apply invocation pattern</h4>

<p>The apply method lets us construct an array of arguments to use to invoke a func- tion. It also lets us choose the value of this. The apply method takes two parame- ters. The first is the value that should be bound to this. The second is an array of parameters.
To identify the differences, I will go to an overall example:Firstly, define an object:</p>

<pre><code>function Person(){  };
</code></pre>

<p>It is just used to demonstrate the object machanism, so we actually have nothing in it.</p>

<p>Secondly, create an instance called p of object Person</p>

<pre><code>var p = new Person();
</code></pre>

<p>Thirdly, create a method <strong>displayneme</strong> by assigning it a function:</p>

<pre><code>p.displayname=function(){

    alert(this); //object p

    return function dis(){ 
        alert(this);  //window
    }
}
var disp = p.displayname();  //get the pointer of the function
disp();   //invoke it
</code></pre>

<p>If we rearrange the order of the code to:</p>

<pre><code>    var p = new Person();
    var disp = p.displayname();  //get the definition of the function
    disp();   //invoke it, error occurs
    p.displayname=function(){

        alert(this); 

        return function dis(){ 
            alert(this);  
        }
    }
    function Person(){
    }
</code></pre>

<p>It will alert an error that Person has no method displayname, but we can still create the p instance before we define an object Person. That is because the constructor function isn raised before the code is executed, while the function p.displayname is loaded when the interpreter reaches that line.</p>

<p>If we look at how the alert box shows us the <strong>this</strong> parameter, we can easily know that the inside the first function, p.displayname, this = object p, while in the second function, dis(), this = global object window. The second function, which is invoked in a function patern, it just doesn&rsquo;t have the access to the object p.</p>

<p>Another way to invoke that inner function is:</p>

<pre><code>p.displayname=function(){

    alert(this); //object p

    return function dis(){ 
        alert(this);  //window
    }();   // invoke directly
}
p.displayname();  //get the pointer of the function
</code></pre>

<p>The function about is called a self-invoking function, by adding a () after the definition of the function. In this way, we don&rsquo;t need to assign the inner function to a variable disp to invoke it, and get the result in the inner function.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript Closure]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/26/javascript-closure/"/>
    <updated>2014-02-26T14:46:25+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/26/javascript-closure</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CSS Crossbrowser Compatibility]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/23/css-crossbrowser-compatibility/"/>
    <updated>2014-02-23T23:35:51+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/23/css-crossbrowser-compatibility</id>
    <content type="html"><![CDATA[<h3>CSS Hacks:</h3>

<p>Techniques and syntax that achieve desired results by exploiting a bug in a particular browsers rendering engine.</p>

<h3>CSS Filters:</h3>

<p>Techniques and syntax that achieve desired results by exploiting a feature that a particular browsers rendering engine does not yet support.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How CSS Visual Formatting Model Works]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/21/how-css-visual-formatting-model-works/"/>
    <updated>2014-02-21T07:35:45+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/21/how-css-visual-formatting-model-works</id>
    <content type="html"><![CDATA[<p>It is a common sense that:</p>

<p>the width of a box = width + margin-left + margin-right + padding-left + padding-right + border-left + border-right (rule 1)</p>

<p>based on the box model in CSS. However, there is one more thing to add:</p>

<p>the default width of a block-level element always = the width of its parent element (rule 2)</p>

<p>until a width is set. Setting width makes a structure less flexible, especially when it refers to a px unit. Let&rsquo;s go to a simple example, we have such html code bellow:</p>

<pre><code>&lt;div&gt;
    &lt;p&gt;blabla&lt;/p&gt;
&lt;/div&gt;
</code></pre>

<p>with a css style:</p>

<pre><code> div{
     border: solid 1px black;
 }
 p{
     border: solid 1px black;
 }
</code></pre>

<p>As expected, the result shows as following:</p>

<p><img src="http://sparkmorry.github.io/images/posts/css/block.png" alt="block" /></p>

<p>Here we have a clear html structure: <strong>html->div->p</strong>, which are all block-level elements. As initialed, the html element has a 100% width of the window by default, thus, the child element div got the same width as his parent, width:100%, and so does the child p element applied rule 2 above. If the width is set by an author:</p>

<pre><code> div{
     border: solid 1px black;
     width:100px; /* the width is set */
 }
 p{
     border: solid 1px black;
 }
</code></pre>

<p>The whole visual formatting changed as bellow:</p>

<p><img src="http://sparkmorry.github.io/images/posts/css/divset.png" alt="block" /></p>

<p>However, a width definition of a child element has no effect on its parent, it doesn&rsquo;t have the control:</p>

<pre><code> div{
     border: solid 1px black;         
 }
 p{
     border: solid 1px black;
     width:100px; /* the width is set */
 }
</code></pre>

<p>Result:</p>

<p><img src="http://sparkmorry.github.io/images/posts/css/pset.png" alt="block" /></p>

<p>You can change the width of the box of the p element by assigning a padding or margin value to it:</p>

<pre><code> div{
     border: solid 1px black;         
 }
 p{
     border: solid 1px black;
     width:100px; /* the width is set */
     padding:100px; /* the padding is set */
 }
</code></pre>

<p>By using the power of padding, the redundant div tag could be removed, if your goal is to creating a box like this:</p>

<p><img src="http://sparkmorry.github.io/images/posts/css/padding.png" style="width:300px;"></img></p>

<p>The whitespace of the border and the centered form could be made simply by using a padding instead of alot of sizing and centering work.</p>

<p>Here, another way of determining the size of an element is called <strong>Block Formatting Context(BFC)</strong> mentioned in CSS Mastery which is often used for the height collapse problem of the blocks with floated children. Conversely, the mechanism goes the posite way from the nomal formatting. When an element is triggered with the BFC, it is responsible for sizing and positioning itself and its children. It common with the widely known <strong>hasLayout</strong> feature in IE browser. That means it decides it size(width and height) and position based on its children instead od its parent. We can see it from the height collapse problem, suppose we have a list:</p>

<pre><code>&lt;ul&gt;
    &lt;li&gt;1&lt;/li&gt;
    &lt;li&gt;2&lt;/li&gt;
    &lt;li&gt;3&lt;/li&gt;
    &lt;li&gt;4&lt;/li&gt;
&lt;/ul&gt;
</code></pre>

<p>and style sheet:</p>

<pre><code>ul{
    border: solid 1px red;
    text-align:center;
    vertical-align:baseline;
    list-style: none;
}


li{
    border: solid 1px black;
    float:left;
    margin:100px;
}
</code></pre>

<p>Result:
<img src="http://sparkmorry.github.io/images/posts/css/float.png" alt="block" /></p>

<p>we mark the border of ul as red so that to identify the parent element, we can see that the height is collapsed. Why does this happen?</p>

<p>While the width of an element is determined by its parent&rsquo;s width, the height of it is enclosed by its children, with a prerequisite that the children are in the normal flow. Setting an element a float style(this happen in absolute positioning as well) takes it out of the normal flow-positioning model, while the parent element is still in the flow. The parent cannot find any children in its normal flow model, thus the height gose to zero when enclosing the box, like how you see in the pic above.</p>

<p>A popular solution to this problem is setting an <strong>overflow:hidden</strong> style to the perent. And that is where Block Formatting Context is triggered. As we mentioned:</p>

<blockquote><p>When an element is triggered with the BFC, it is responsible for sizing and positioning itself and its children.</p></blockquote>

<p>The word <strong>responsible</strong> explicates how the BFC works: it is forsed to cauculate the height based on its children&rsquo;s height no matter if they are in normal-positioning flow or not. A block formatting context is created by one of the following:</p>

<ul>
<li>float other than none</li>
<li>position fixed or absolute</li>
<li>display inline block</li>
<li>table cells (elements with display: table-cell, which is the default for HTML table cells)</li>
<li>table captions (elements with display: table-caption, which is the default for HTML table captions)</li>
<li>overflow other than visible</li>
<li>flex boxes (elements with display: flex or inline-flex)</li>
</ul>


<p>Notice here the trigger is about the parent, that means, the float, absolute psition, or overflow:hidden is set to the parent, we can see the results:</p>

<p>By set overflow: hidden:
<img src="http://sparkmorry.github.io/images/posts/css/overflow.png" alt="block" />
By set float: left or position: absolute:
<img src="http://sparkmorry.github.io/images/posts/css/abso.png" alt="block" /></p>

<h3>Summary</h3>

<p>Those are almost the main machenisms of the Visual Formatting Model in CSS. And here are the three formatting models in CSS: normal flow, absolute positioning, and floating. We can figure out the first one by rule 1 and rule 2 in the artucle, while the last two is a little more complicated to figure by the Block Formatting Context. There are always multiple solutions when dealing withe css problems, it is a good way to practice and learn from the cases.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[He Is Going to Princeton]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/18/he-is-going-to-princeton/"/>
    <updated>2014-02-18T19:25:17+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/18/he-is-going-to-princeton</id>
    <content type="html"><![CDATA[<h3>Yes, still cannot help missing him.</h3>

<p>It&rsquo;s been almost 7 years, since we first met. You sat there still at the back of the room, looking at me. Silence, and heart beating so loudly. I thought I must have met you before, but actually not. Being a classmate of you, I didn&rsquo;t talk to you except the first days when you kept asking my name. Feeling so sorrow to be forgotten, we were just too young to love.</p>

<p>The real story began about 5 years ago. It was a hard time with the endless homework for a third-year high school student in China. The only common thing among us could be that we are both boarders, and good at physics in a way. You started to talk with me, asked me questions, glared at me when I was talking to other boy, playing with my pens, looked at me when I was called by the teacher for questions like a real couple, but actually we were not. Those sweet days were kept in my whole life, I thought I was flipped, completely. I swear I loved you more than any boyfriend I have ever dated.</p>

<p>Not all stories get a happy ending. It ends up with my stupid stubbornness and pride. I know it&rsquo;s hard to restart, but I will try. Before that, I still want to improve myself so that to talk to you without my inferiority the next time I see you. As you deserve a better girl. Life is long, it&rsquo;s never too late to chatch. Focus on my next 3 years, and hope it sparks!</p>

<p>Congratulations!</p>

<p>Sincerely,</p>

<p>yours,</br>
forever admirer.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Use CSS More Efficiently]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/16/how-to-use-css-more-efficient/"/>
    <updated>2014-02-16T13:00:05+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/16/how-to-use-css-more-efficient</id>
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;It all starts from a <a href="http://stackoverflow.com/questions/1875852/define-colors-as-variables-in-css">question</a> on stackoverflow. I have been working on the website <a href="http://www.weixinfr.com/">weixinfr</a> these days, as we haven&rsquo;t decided the main color style yet, it troubles me repeatedly changing from color to color. For instance, I use red as the color of active link, some titles, the background color of buttons and some selectors. But what if I want to change the color style to green next time? Should I find all the &ldquo;red&rdquo;(or #whatever) keyword in the text and determine on each fragment if it is the one to change?</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;Color, font, positioning are the main functions of css, I used to define all of them on a certeain box, like:</p>

<p>for box1:</p>

<pre><code>#nav-wrapper{
    position:fixed;  //positioning
    height: 60px;
    z-index: 60;
    width: 100%;
    padding: 0;
    margin:0;
    text-align: center;   //for text
    background-color: #fff;    //bg-color
    color: red;
    border-bottom: solid 1px #ececec;     //color
}
</code></pre>

<p>for box2, repeatedly:</p>

<pre><code>#login-form{
    text-align: left;
    color: white;
    position: absolute;
    top: 70px;
    right: 80px; 
    z-index: 80;
    display: block;
    background-color: rgba(0,0,0,0.4); 
    padding: 20px 35px;
}
</code></pre>

<p>so everytime I am going to change, I have to check every box to change the color. The idea comes into my mind that how can I use a variable to store the number of the color, and put it somewhere I use it? I know something like <a href="http://lesscss.org/">less</a> makes it possible, but I also want some css solutions. Some anwsers on stackoverflow really inspires me. Colour reference chart, CSS3 variables, sass/scss, grouping the selectors only on color, and setting up a .red class
Actually, I suppose the idea of the last two are the same: always group up the common style/feature togeter. One of the most exciting things in css is each element can have more than one class. To compare with the 2 solutions, we can still find some differences though. By defining a class called &ldquo;red_text&rdquo;, I am forced to guess to which element that class could refer to remove or add the class, and things are already starting to get confusing. And once I want to change the color to green, I have to rename it &ldquo;green_text&rdquo; for the readability, and do the find-replace routine to update the whole html file.</p>

<pre><code>.red{color:red;}
</code></pre>

<p>The new problem is mentioned in the book &lt;<a href="http://book.douban.com/subject/3887227/">CSS Mastery</a>>:</p>

<blockquote><p>It makes sense to name your elements based on what they are rather than how they look. That way your code will have more meaning and never go out of sync with your designs.</p></blockquote>

<p>He also gives a pic for the recommanded names as below:</br>
<img src="http://sparkmorry.github.io/images/posts/css/naming.jpg"/></p>

<p> Alternatively, the second one makes it a little better, it only deals with the css file. But the trouble is you need to be careful about the selectors and probably generate a long chaind of ID selectors like:</p>

<pre><code>#section1, #section2, #section3, #section4 {color:red;}
</code></pre>

<p>It is caused by the unstructual code like how I used to add classes/ids to nearly everything in an attempt to get fine-grained control over the styles. The debates between Id and Class is also a problem we encountered when styling. With the overreliance on id or class names, we will run out of unique names very quickly and end up creating extremely long and complicated naming conventions.
A combined solution is given by the author, create a generic class for them all.</p>

<p>  To conclude, a good choice is to name the elements based on what they are, like popout/highlight, warning, etc, and group up common features in a class, like combine foot_nav, top_nav, aside_nav to nav and use ID to identify something extremely specific. And group up the classes, elements, IDs in common feature into a style instaed of assigning them seperately.</p>

<pre><code>.popout, h1, .warning {color:red}
</code></pre>

<p>There is no right answer, it all defers from the authors and the circumstances. New techs will lead up a new generation, gives new solutions. Let me end up with the quote of CSS Mastery:</p>

<blockquote><p>Although the goal is to keep your code as lean and mean(ingful) as possible, sometimes you cannot avoid adding an extra nonsemantic div or span to get the page to display the way you want. If this is the case, don’t fret too much over it. We live in a transitional period, and CSS 3 will give us much greater control of our documents. In the meantime, real-world needs often have to come before theory. The trick is knowing when you have to make a compromise and if you are doing it for the right reasons.</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress Journey]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/12/octopress-journey/"/>
    <updated>2014-02-12T16:42:24+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/12/octopress-journey</id>
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;After one-day searching, I finally set up my own blog by octopress. It looks so amazing and I just fall in love with the green markdown at the first glance. I will just imigrate the previous blog <a href="http://www.cnblogs.com/sparkmorry/">http://www.cnblogs.com/sparkmorry/</a> @cnblog here.</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;This is just a testing post where I learn how to write an article with markdown and post it under a certain page. According to the documentation of Octopress, to write a new post and create a new page:</p>

<pre><code>rake new_page[super-awesome]
# creates /source/super-awesome/index.markdown

rake new_page[super-awesome/page.html]
# creates /source/super-awesome/page.html
</code></pre>

<p>to publish:</p>

<pre><code>rake generate   # Generates posts and pages into the public directory
rake watch      # Watches source/ and sass/ for changes and regenerates
rake preview    # Watches, and mounts a webserver at http://localhost:4000
rake deploy
rake gen_deploy #combination
</code></pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;I have come across a problem of the blog configuration, the source code should be under the root directory for preview, or maybe by changing somewhere else. I am still in my process of learning this new awsome tool.</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;Here in my blog, the posts are under <a href="http://sparkmorry.github.io/">Articles</a>. The articles are mainly about the reflections on front-end development and my daily life. Also, you may see some recent work on drawings or photographies under <a href="http://sparkmorry.github.io/painting/">Gallery</a> as I really like both of them. For more infomation, plz see <a href="http://sparkmorry.github.io/about/">About page</a>. Thanks to github and octopress that I can set up the blog for free.</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; If you have any issues or questions on the code or posts, please contact me. Lastly, I&rsquo;m so pleasant of having your visit on this blog.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曲线参数化的Javascript实现（代码篇）]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/06/qu-xian-can-shu-hua-de-javascriptshi-xian-%28dai-ma-pian-%29/"/>
    <updated>2014-02-06T22:48:03+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/06/qu-xian-can-shu-hua-de-javascriptshi-xian-(dai-ma-pian-)</id>
    <content type="html"><![CDATA[<p><a href="http://sparkmorry.github.io/blog/2014/01/30/qu-xian-can-shu-hua-de-javascriptshi-xian-%28dai-ma-pian-%29/">在曲线参数化的Javascript实现（理论篇）</a>中推出了曲线弧长积分的公式，以及用二分法通过弧长s来查找样条曲线上对应的u，再求Q(u)的值。弧长积分函数如下：</p>

<p><img src="http://sparkmorry.github.io/images/posts/Param/ds.png" style="width:300px;"></img>，其中<img src="http://sparkmorry.github.io/images/posts/Param/ABCDE.png" style="width:200px;"></img>－－－－－公式1</p>

<p>Simpson展开后</p>

<p><img src="http://sparkmorry.github.io/images/posts/Param/Simpson.png" style="width:300px;"></img>－－－－－－－公式2</p>

<p>这里的f(u)就是上面的弧长s的求值函数，既样条曲线拟合函数Q(u)的积分</p>

<p>这部分具体代码如下：1.计算f(u)的系数ABCDE</p>

<pre><code>CParametric.prototype.SegCoef = function(CSpline, o)
{        
    p0.x=this.k[0]*CSpline.Spline[o].x+this.k[1]*CSpline.Spline[o+1].x+this.k[2]*CSpline.Spline[o+2].x+this.k[3]*CSpline.Spline[o+3].x;
    p1.x=this.k[4]*CSpline.Spline[o].x+this.k[5]*CSpline.Spline[o+1].x+this.k[6]*CSpline.Spline[o+2].x+this.k[7]*CSpline.Spline[o+3].x;
    p2.x=this.k[8]*CSpline.Spline[o].x+this.k[9]*CSpline.Spline[o+1].x+this.k[10]*CSpline.Spline[o+2].x+this.k[11]*CSpline.Spline[o+3].x;
    p3.x=this.k[12]*CSpline.Spline[o].x+this.k[13]*CSpline.Spline[o+1].x+this.k[14]*CSpline.Spline[o+2].x+this.k[15]*CSpline.Spline[o+3].x;

    p0.y=this.k[0]*CSpline.Spline[o].y+this.k[1]*CSpline.Spline[o+1].y+this.k[2]*CSpline.Spline[o+2].y+this.k[3]*CSpline.Spline[o+3].y;
    p1.y=this.k[4]*CSpline.Spline[o].y+this.k[5]*CSpline.Spline[o+1].y+this.k[6]*CSpline.Spline[o+2].y+this.k[7]*CSpline.Spline[o+3].y;
    p2.y=this.k[8]*CSpline.Spline[o].y+this.k[9]*CSpline.Spline[o+1].y+this.k[10]*CSpline.Spline[o+2].y+this.k[11]*CSpline.Spline[o+3].y;
    p3.y=this.k[12]*CSpline.Spline[o].y+this.k[13]*CSpline.Spline[o+1].y+this.k[14]*CSpline.Spline[o+2].y+this.k[15]*CSpline.Spline[o+3].y;

    this.A=9*(p0.x*p0.x+p0.y*p0.y);
    this.B=12*(p0.x*p1.x+p0.y*p1.y);
    this.C=6*(p0.x*p2.x+p0.y*p2.y)+4*(p1.x*p1.x+p1.y*p1.y);
    this.D=4*(p1.x*p2.x+p1.y*p2.y);
    this.E=p2.x*p2.x+p2.y*p2.y;
}
</code></pre>

<p>这里的k数组是Cardinal样条曲线的Mc矩阵，具体内容可以参考Cardinal样条曲线的Javascript实现（理论篇）。这里的p0,p1,p2,p3就是公式1里的ax,ay,bx,by,cx,cy,dx,dy。从而求得积分函数系数。</p>

<p>2.计算扩展的Simpson方法展开后得到的积分函数</p>

<pre><code>CParametric.prototype.ArcLength = function(ustart, uend){
    var h,sum,u;
    var i;
    h=(uend-ustart)*1.0/ITERATION_COUNT; //扩展的Simposon方法的阶数
    sum=0;
    u=ustart+h;

    for(var i=2; i &lt;= ITERATION_COUNT; i++){
        if(!(i&amp;1)){
            sum += 4.0*this.ArcIntergrand(u);
        }
        else{
            sum += 2.0*this.ArcIntergrand(u);
        }
        u += h;
    }
    return(h*this.ArcIntergrand(ustart)+sum+this.ArcIntergrand(uend)/3.0);
}
</code></pre>

<p>这里的ITERATION_COUNT是扩展的Simposon方法的阶数，既公式2中的n，其中的ArcIntergrand(u)就是求fi的值，代码如下：</p>

<pre><code>CParametric.prototype.ArcIntergrand = function(u)
{
    var f;
    f=this.A*u*u*u*u+this.B*u*u*u+this.C*u*u+this.D*u+this.E;
    f=Math.sqrt(f);
    return f;
}
</code></pre>

<p>3.建立s－u索引表</p>

<p>上面的积分函数只能得到没一个曲线段上一个u对应s的值，而一整条样条曲线由多个小曲线段组成，比如计算第二段曲线上累加的s的值的时候只要把前面那段曲线的总长作为一个基数加上去就可以了。建立了s－u索引表之后就可以用二分法来查找每个给定的s对应的u的值了。因为这个函数是严格单调递增的，所以这个索引表肯定是升序的，就可以用二分法来查找。具体代码如下：</p>

<pre><code>CParametric.prototype.SetLengths = function(spline, npoints){
    var no_segments;    //u分割的精度
    var arcLength;
    this.seg_lengths = new Array();

    no_segments = npoints-3;
    arcLength = 0;

    this.seg_lengths[0]=0;
    for(var i=0; i&lt;no_segments; i++){
        this.SegCoef(spline, i);
        arcLength += this.ArcLength(0.,1.);   //ArcLength(0,1)就是前面一个曲线段的总长
        this.seg_lengths[i+1] = arcLength;
    }
    this.total_length = arcLength;
    for(var i=1; i&lt;no_segments; i++){
        this.seg_lengths[i] /= this.total_length;  //s归一化
    }
}
</code></pre>

<p>因为弧长累加的值较大，所以对其进行归一化之后可以得到更标准的弧长值。</p>

<p>4.二分法计算弧长为seg的曲线上的点的位置pt</p>

<pre><code>CParametric.prototype.ArcLengthPoint = function(spline, seg){
    var uL=0., uR=1., usearch;
    var segment_dist, ssearch;
    var segment_no=0;

    do{
        segment_no++;
    }while(this.seg_lengths[segment_no] &lt; seg);
    segment_no --;
    segment_dist = this.total_length*(s-this.seg_lengths[segment_no]);

    this.SegCoef(spline,segment_no);

    do{
        usearch = (uL+uR)/2;
        ssearch = this.ArcLength(uL, usearch);

        if(segment_dist &lt; ssearch+SEARCH_TOL){
            uR=usearch;
        }
        else{
            uL=usearch;
            segment_dist -= ssearch;
        }
    }while((segment_dist&gt;ssearch+SEARCH_TOL) || (segment_dist&lt;ssearch-SEARCH_TOL));
    this.GetPointOnSpline(usearch);

};
</code></pre>

<p>就是普通的二分查找法，给定一个弧长seg，在函数曲线上找到对应的u的值，返回的usearch就是在指定精度var SEARCH_TOL=0.5（可以任意指定）的情况下得到的u的值。再通过调用this.GetPointOnSpline(usearch)函数来计算u=usearch时对应的Q(u)的值。</p>

<pre><code>CParametric.prototype.GetPointOnSpline=function(usearch){
    this.pt[pointnum]= new CPT();
    this.pt[pointnum].x=p0.x*usearch*usearch*usearch+p1.x*usearch*usearch+p2.x*usearch+p3.x;
    this.pt[pointnum].y=p0.y*usearch*usearch*usearch+p1.y*usearch*usearch+p2.y*usearch+p3.y;
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Self-invoking Function in Javascript]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/02/05/self-invoking-function-in-javascript/"/>
    <updated>2014-02-05T23:31:52+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/02/05/self-invoking-function-in-javascript</id>
    <content type="html"><![CDATA[<p>在看bootstrap的轮播插件源码的时候发现一种新的自调函数的写法（其实应该不新了），开头的一段就卡住了，原谅我是个菜鸟，就顺便记录一下。stackoverflow上有大神们的回答在这里，轮播的函数形式如下：</p>

<pre><code>!function ($) {
   //code here
}(window.jQuery);
</code></pre>

<p>通常自调函数来模仿块级作用域的方式是：</p>

<pre><code>(function(parameters){
     //这里是块级作用域
})();
</code></pre>

<p>在function外面的这对括号使里面的匿名函数变成了函数表达式，并在之后马上调用。这个相当于：</p>

<pre><code>var Name=function(parameters){
   //这里是块级作用域
}; 
Name();  //调用匿名函数
</code></pre>

<p>函数表达式是在运行中以引用的方式赋值给一个变量的，如上面的函数创建的方式。而这里函数表达式和函数声明是不一样的，函数声明的通常形式如下：</p>

<pre><code>function Name(parameters){
    //code here
}
</code></pre>

<p>函数声明会在程序刚开始运行的时候会被提升（所以可以在执行之后声明），但是并不执行，直到被调用的时候再执行。</p>

<p>所以与括号作用相同的function前面的感叹号，因为括号的优先级高于感叹号，感叹号使得后面的一整串内容变成了一个bool表达式，编译器就会直接运行这个表达式了。这个表达式是个匿名函数，传入了一个参数，这里命名成$，其实无所谓是什么，只是一个形参，并在自调的时候把jQuery对象传进去，这里的jQuery对象是个全局变量，所以是windows.jQuery</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[曲线参数化的Javascript实现（理论篇）]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/01/30/qu-xian-can-shu-hua-de-javascriptshi-xian-%28li-lun-pian-%29/"/>
    <updated>2014-01-30T22:48:03+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/01/30/qu-xian-can-shu-hua-de-javascriptshi-xian-(li-lun-pian-)</id>
    <content type="html"><![CDATA[
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cardinal样条曲线的Javascript实现(代码篇)]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/01/29/cardinalyang-tiao-qu-xian-de-javascriptshi-xian-dai-ma-pian/"/>
    <updated>2014-01-29T11:08:00+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/01/29/cardinalyang-tiao-qu-xian-de-javascriptshi-xian-dai-ma-pian</id>
    <content type="html"><![CDATA[<p>由上一篇文章得到了Cardinal曲线的矩阵表达式，下面就这个矩阵表达式就可以来对曲线进行插值了。</p>

<p>这里选用了JS来实现，完全是因为之前交作业的时候还不知道怎么在Xcode里建完整的C++OpenGL的项目，所以就用js在浏览器这个最大的跨平台UI上写。。</p>

<p>先看之前得到的Cardinal插值的样条曲线的矩阵，对每一段曲线PkPk+1来说，都可以通过拟合一个被参数化为P(u)函数（0&lt;= u &lt;=1）的图形的形式：</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal5.png" style="width:220px;"></img>，其中
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal6.png" style="width:220px;"></img></br></p>

<p>同样，M*P得到的是系数矩阵[a b c d]的转置，s是引入的表示每个连接点处曲线尖锐程度的变量－张量</p>

<p>所以我们现在的期望是</p>

<p>输入：n个控制点的xy轴坐标数组x[],y[]，张量tension，每两个控制点之间插入的密度grain</p>

<p>输出：插值好的样条曲线上控制点的一个数组</p>

<p>1.构造函数 function CSpline(x, y, grain, tension, n)</p>

<p>拥有的成员变量和成员函数：</p>

<pre><code>function CSpline(x, y, grain, tension, n) {   
    var jd = new Array(100);  //用户输入的控制点位置数组，临时变量存储
    this.n0=n;   //控制点个数
    this.m = new Array(16);  //Mc矩阵
    this.Spline = new Array(1024);  //插值好的控制点数组
    CSpline.prototype.GetCardinalMatrix = function(a1) {}    //通过给定的tension值生成Mc矩阵
    CSpline.prototype.Matrix = function(a, b, c, d, u){}   //计算P(u)的值，xy分量均相同
    CSpline.prototype.CubicSpline = function(np, knots, grain, tension) {}   //插值函数

    //临时函数，建立曲线控制点数组jd，并调用CubicSpline函数计算插值曲线
    function CSpline(x, y, grain, tension, n)      
    { 
        for(var i=1; i&lt;=np; i++){
        　　jd[i] = new CPT(x[i-1],y[i-1]);   //内部点
        }
        jd[0] = new CPT(x[0],y[0]);  //补上隐含的整条曲线起始点
        jd[np+1] = new CPT(x[np-1],y[np-1]);    //补上隐含的整条曲线终止点
        np=np+2;   
        this.CubicSpline(np, jd, grain, tension);
    }
}      
</code></pre>

<p>这里成员变量通过构造函数分别在实例中存储，而成员函数则在对应的原型函数中存储。</p>

<p>2.计算Mc矩阵函数GetCardinalMatrix = function(a1)</p>

<p>根据输入的平滑度 tension 值计算Mc矩阵</p>

<pre><code>CSpline.prototype.GetCardinalMatrix = function(a1) {
    this.m[0]=-a1; this.m[1]=2.0-a1; this.m[2]=a1-2.; this.m[3]=a1;                 
    this.m[4]=2.*a1; this.m[5]=a1-3.; this.m[8]=-a1; this.m[9]=0.;
    this.m[12]=0.; this.m[13]=1.; this.m[6]=3.-2*a1; this.m[7]=-a1;
    this.m[10]=a1; this.m[11]=0.; this.m[14]=0.; this.m[15]=0.;
} 
</code></pre>

<p>这里m是一个4*4的矩阵，a1表示tension值</p>

<p>3.计算P(u)的值</p>

<p>输入4个点Pk-1,Pk,Pk+1,Pk+2的值(x分量或者y分量，以及参数化好的u值)，返回计算得到的P(u)的值</p>

<pre><code>CSpline.prototype.Matrix = function(p0, p1, p2, p3, u){ 
    //求解系数
    var a, b, c, d;
    a=this.m[0]*p0+this.m[1]*p1+this.m[2]*p2+this.m[3]*p3;    
    b=this.m[4]*p0+this.m[5]*p1+this.m[6]*p2+this.m[7]*p3; 
    c=this.m[8]*p0+this.m[9]*p1+this.m[10]*p2+this.m[11]*p3; 
    d=this.m[12]*p0+this.m[13]*p1+this.m[14]*p2+this.m[15]*p3; 
    return(d+u*(c+u*(b+u*a))); //au^3+bu^2+cu+d
}
</code></pre>

<p>4.主要绘制函数CSpline.prototype.CubicSpline = function(np, knots, grain, tension)</p>

<pre><code>CSpline.prototype.CubicSpline = function(np, knots, grain, tension) {
    alpha = new Array(50);
    var k0, kml, k1, k2;
        //获取Mc矩阵
        this.GetCardinalMatrix(tension);
        //对每两个关键点之间的插值点进行参数化到0～1之间
    for(var i=0; i&lt;grain; i++){
        alpha[i]=i*1.0/grain;
    }
        //从最开始的四个点开始，给第一段曲线插值
    kml = 0;
    k0 = 1;
    k1 = 2;
    k2 = 3;
    this.s = 0; //纪录总共插值后的点数
        //两次循环第一次对输入的控制点遍历，第二次对每两个控制点之间插值，分别计算xy分量上得出的插值后的函数值，k值分别＋1
    for(var i =1; i&lt;this.n0; i++){
        for(var j=0; j&lt;grain; j++){
            cpx = this.Matrix(knots[kml].x, knots[k0].x, knots[k1].x, knots[k2].x, alpha[j]);
            cpy = this.Matrix(knots[kml].y, knots[k0].y, knots[k1].y, knots[k2].y, alpha[j]);
            this.Spline[this.s] = new CPT(cpx, cpy);
            this.s++;
        }
        kml++; k0++; k1++; k2++;
    }
}
</code></pre>

<p>最后的结果截图如下：</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/t1.png" style="width:420px;"></img></br></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cardinal样条曲线的Javascript实现(理论篇)]]></title>
    <link href="http://sparkmorry.github.io/blog/2014/01/29/cardinalyang-tiao-qu-xian-de-javascriptshi-xian-li-lun-pian/"/>
    <updated>2014-01-29T00:46:42+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2014/01/29/cardinalyang-tiao-qu-xian-de-javascriptshi-xian-li-lun-pian</id>
    <content type="html"><![CDATA[<p>首先，要对样条曲线进行插值的原因是：希望通过给定的关键帧点生成一条希望的直线或者曲线。</p>

<p>1.直线插值</p>

<p>　　生成一条直线，给定直线首尾的关键点P0,P1，就能确定这条直线的特性，比如y=kx+b中的斜率k和y轴偏移值b。通过线性（P0,P1线性相关）插值（线性的给中间插上一定数量的点使看起来连续）的方式就可以得到我们要的线段。
<img src="http://sparkmorry.github.io/images/posts/Cardinal/linear.png" style="width:400px;"></img></br>
　　　　　　　　　　图1.1</p>

<p>2.曲线插值</p>

<p>　　但是对于曲线来说比较难确定，我们要对于给定的参数生成唯一的一条曲线并且可以进行方便的调整。这里要确定每一小段曲线，我们需要4个参数，首尾点的位置(参数化后的P(u))及他们的方向（在代数上表现为一阶导数P&#8217;(u)的值），并进行平滑的过渡，通过插值来实现对中间点的计算。再将每个小段的曲线进行连接。<br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/segment.png" style="width:220px;"></img></br>
　　　　　图2.1</p>

<p>　　曲线的生成分为两个部分：</p>

<p>　　　　1)对每给定的两个关键帧点之间进行插值得到一段曲线（如图2.1）</br>
　　　　2)连接两两关键帧点的曲线段（如图2.2对曲线段进行连接）<br></p>

<p><img src="http://sparkmorry.github.io/images/posts/Cardinal/kp.png" style="width:400px;"></img></br>
　　　　　　　　图2.2</p>

<p>2.1 三次多项式插值</p>

<p>　　先就两个关键帧点之间的插值做计算。我的理解主要的思想是通过一个参数化的函数曲线去拟合，因此要通过给定的条件（如图2.1中的P(0),P(1),P&#8217;(0),P&#8217;(1)）去确定这个函数的几个系数。然后通过在中间等间距的插点计算根据函数得到的值确定点的位置。这里选择参数化的三次多项式(）去拟合这条曲线，通过插值来求得中间点的位置。这里，选择三次多项式的原因是：灵活性和计算速度的折中方案。</p>

<p>　　1)与更高次多项式相比，三次样条只需较少的计算与存储空间，并且较为稳定；（只需要一个4*4的基函数矩阵）</br>
　　2)与更低次多项式相比，三次样条在模拟任何曲线形状时显得更灵活。（能满足大多数情况下的曲率调整，比如二次抛物线太对称，一次就是直线）</br></p>

<p>2.2 曲线连续性</p>

<p>　　为了保证分段参数曲线从一段到另一端平滑过渡，可以在连接点处要求各种连续性（可以参考微积分中的函数连续性与导数的关系）。</p>

<p>　　C0连续：有相同的公共点，如图(a)</br>
　　C1连续：有相同的公共点且公共点处有相同的一阶导数（切线斜率），如图(b)</br>
　　C2连续：有相同的公共点且有相同的公共点且公共点处有相同的一阶导数和二阶导数（切线斜率的变化率），如图c <br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/conti.png" style="width:400px;"></img></br>
　　　　　　　　　　图2.3</p>

<p>2.3 自然样条曲线</p>

<p>　　一种简单的插值方法是自然样条插值，就是对如图2.2的一条有n+1个控制点（P0～Pn）n个分段的曲线求三次多项式系数这样就有4n个系数要确定（需要列出4n个方程才能求解出来），通过曲线内部的n－1个点每相邻曲线段公共点的一阶及二阶导数相等且都通过该点，能确定4n－4 [4*(n-1)]个方程，再加上两个“隐含”控制点P0和Pn的二阶导数为0得到4n个方程来求解。缺点是一个点发生了变化其他点都跟着受到影响，这里不做主要展开了。　　　　　　　　　　　　</p>

<p>2.4 Hermite插值</p>

<p>　　为了解决自然样条曲线不能局部控制的缺点，Hermite插值对每个控制点的切线进行了限制为D（由用户给出），这样切线就变成了D*Pk（D斜率＋经过该点），使每个曲线段仅依赖于端点位置的约束。如对每小段曲线的边界条件表示为：</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/hermite1.png" style="width:120px;"></img></br>
公式1</p>

<p>这里P是向量，对于xy分量来说分别都符合这个边界条件。那么如何保证曲线连续的呢？即对于一个连接点Pk-1来说，这段曲线相应的终点为Pk，在下一段曲线里Pk则作为这段曲线的起始点，保证Pk这个点的函数值和导数值相等就可以。现在点的位置都是Pk，导数值都是DPk，二阶导数值都是D。</p>

<p>可以写出向量方程：</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/hermite2.png" style="width:300px;"></img></p>

<p>其中P和abcd都是向量，可以再xy分量上（2维情况下）分别表达成这种形式，如，y分量也是类似，组合成的表达，可以获得等价的矩阵形式表达：</p>

<p>以及导数的矩阵表达式：</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/hermite3.png" style="width:200px;"></img></p>

<p>通过公式1，用u＝0和u＝1替代上面的u就可以得到以下方程：
</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/hermite4.png" style="width:200px;"></img></br></p>

<p>如Pk=P(0)=[0 0 0 1]*[a b c d]&lsquo;，这里每一个曲线段上的点都被参数化到0～1之间，所以起始点就是P(0),终止点就是P(1)，利用线代方法（参考线性方程求解）通过4个参数对多项式系数求解</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/hermite5.png" style="width:250px;"></img></br></p>

<p>最后边界条件的表达式如下</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/hermite6.png" style="width:250px;"></img></br></p>

<p>其中M*P部分就是通过对Hermite函数推导得到的系数矩阵[a b c d]&lsquo;，Pk和Pk+1由用户给定，DPk和DPk+1由给定D值计算获得，根据不同的控制方式可以生成有不同曲线，Cardinal曲线就是Hermite曲线的一种变形，通过对切线斜率进行控制来控制曲线的平滑度。</p>

<p>2.5 Cardinal样条曲线</p>

<p> 　　因为在Hermite曲线中斜率D还是需要用户给出，Cardinal样条曲线可以由相邻两控制点坐标来计算斜率从而使曲线完全由控制点Pk来决定，但是在这里引入了一个t作为在每个公共点上尖锐程度的控制值。</p>

<p>Cardinal曲线的边界条件方程：</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal1.png" style="width:180px;"></img></br>
这样控制点Pk和Pk+1处的斜率和弦PkPk+2和PkPk+1成正比（理解为表示比较接近的控制点对曲线曲率的影响）</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal2.png" style="width:230px;"></img></br>
其中t（称为张量）控制Cardinal样条和输入控制点之间的松紧程度，对曲线的影响程度可以通过下图看出来</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal3.png" style="width:230px;"></img></br>
通过跟Hermite类似的系数求解方式，将边界条件代入可以得到矩阵表达式：</p>

<p>P(u)</br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal4.png" style="width:300px;"></img></br>
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal5.png" style="width:220px;"></img>，其中
<img src="http://sparkmorry.github.io/images/posts/Cardinal/Cardinal6.png" style="width:220px;"></img></br></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在Mac环境下跑汇编]]></title>
    <link href="http://sparkmorry.github.io/blog/2013/12/30/zai-machuan-jing-xia-pao-hui-bian/"/>
    <updated>2013-12-30T23:12:34+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2013/12/30/zai-machuan-jing-xia-pao-hui-bian</id>
    <content type="html"><![CDATA[<p>今天汇编作业做到第七章，就想在Mac下跑自己的asm程序，看到了一个很好的<a href="http://www.raywenderlich.com/37181/ios-assembly-tutorial">教程</a></p>

<p>虽然对自己没有用，但是对汇编又有了一次了解，一些嵌入式设备系统如ios之类的是主要基于arm体系结构的操作系统，而pc机上的大多是基于intel体系结构的操作系统。查到了几种编译汇编代码的方式：</p>

<ol>
<li><p>用nasm直接编译.asm文件：</p>

<p>  nasm -f macho hello.asm</p>

<p> 生成可执行文件：</p>

<p>  ld -o hello -e mystart hello.o</p>

<p>  运行</p>

<p> ./hello</p>

<p> 检查退出</p>

<p> echo $?</p></li>
<li><p>用gcc在.c文件中嵌套asm代码：</p>

<p> gcc -Wall -m32 -O3 -fasm-blocks convert.c -o convert</p>

<p> 运行</p>

<p> ./convert</p></li>
<li><p>本来想直接运行书里的代码，但是发现书里的代码都是用masm语法编程的，所谓masm就是windows平台下的汇编编译器（对应linux下是nasm），所以在自己的电脑上就坑爹的跑不起来了，但是查到还是可以用一些如DOSbox的工具编译的asm文件然后和c文件连起来的。下了DOSbox，还要配置实在有些麻烦就想着还是明天去实验室做大程的时候顺便写吧，懒得折腾了。</p></li>
<li><p>生成list文件</p></li>
</ol>


<p>nasm -f elf 6-2.asm -l 6-2.lst</p>

<p>顺带出来的.o里面有一堆机器码，比原来的程序长很多
.lst文件是.asm文件翻译成机器码的结果就是一对一的翻译</p>

<p>反汇编
ndisasm 6-2.o</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Install Opencv on Mac]]></title>
    <link href="http://sparkmorry.github.io/blog/2013/12/10/install-opencv-on-mac/"/>
    <updated>2013-12-10T00:15:32+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2013/12/10/install-opencv-on-mac</id>
    <content type="html"><![CDATA[<p>下载好opencv之后</p>

<ol>
<li><p>在文件夹下新建一个release或build的文件夹；</p></li>
<li><p>cmake .</p></li>
</ol>


<p>　make</p>

<p>Python中运行：</p>

<p>在该build文件夹下</p>

<p>nano .bash_profile</p>

<p>把python的路径加下去</p>

<p>export PYTHONPATH=/usr/local/lib/python2.7/site-packages/:$PYTHONPATH</p>

<p>Xcode中运行，可能碰到的一些问题：</p>

<ul>
<li>usr/local/include和usr/local/lib的问题就不说了，编译之前要把头文件和动态库都连进去否则会产生dyld: Library not loaded的错误</li>
<li>dyld: Library not loaded: cv2.so，有放到cv2.so檔案的, 則是要記得到Build Phases（project target下）內，把選項改為optional</li>
<li>Undefined symbols for architecture x86_64:
C++库和opencv库编译不一致，将XCode的C++ Standard Library改为GNU C++ standard library即可正常编译显示图片。Project Build settings &ndash;> APPLE LLVM compiler 4.2 &ndash; Language &ndash;> C++ Standard Library</li>
</ul>


<p>在这里赞一下这个<a href="http://wiki.opencv.org.cn/index.php/%E9%A6%96%E9%A1%B5">网站</a>，里面有很多例程参考，每个都有不同语言的版本</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Steganography]]></title>
    <link href="http://sparkmorry.github.io/blog/2013/11/12/steganography/"/>
    <updated>2013-11-12T00:42:02+08:00</updated>
    <id>http://sparkmorry.github.io/blog/2013/11/12/steganography</id>
    <content type="html"><![CDATA[<p>今天做DAM的作业，做到图片水印的时候，想起来当初小调同学把言页之庭的种子通过图片发给我。看到下面<a href="http://war.163.com/10/0712/17/6BDLNUB90001123L.html">这个新闻</a>真是觉得碉堡了！！</p>

<p>下面分享一下自己用python实现的隐写术，后面如果有时间会再更深入研究一下解码的问题！！</p>

<p>基本思路是：</p>

<p>1.每张图片都有RGB三个通道，每个像素点的值为3个8位的R/G/B值。</p>

<p>2.把每个RGB值的最后两位&amp;11111100(0xFC)移掉，因为最后两位对图片的影响不大，肉眼基本不可见</p>

<p>3.把要隐藏的图片的RGB值都除以85(255/3=85)，这样正好可以通过2bits(00-11,0-3)来表示图片</p>

<p>4.把得到的值填到之前的2个空bit中</p>

<p>5.等解码的时候只要把之前在原图中藏进去的2位提取出来(&amp;0x3)再＊85就可以得到原图信息</p>

<p>还有一种方法是把信息写道Alpha通道里并按RBG格式编码，解码时用L格式。</p>

<p>但是图片会失真一点，因为毕竟相比8位的存储，2位的存储信息会少很多，但是却已经可以看到80%的图片信息了。所以不得不再赞一下二八法则，20%的编码信息里存储了80%的图片信息啊。</p>

<pre><code>import Image,ImageChops

def waterMark(originFile,markFile):
    origin = Image.open(originFile)
    mark = Image.open(markFile)
    size = mark.size #record the original size of the marked image
    mark = mark.resize(origin.size) #set the pics in same size

    origin.load();
    mark.load()
    source1=origin.split() #split the pic in 3 channel
    source2=mark.split()

    image=[(),(),()]
    waterMark=[(),(),()]
    for x in [0,1,2]: #loop in 3 channel, RGB
        image[x]=source1[x].point(lambda i:i &amp; 0xFC) #remove the last 2 bits of the original image, 0xFC=11111100
        waterMark[x]=source2[x].point(lambda i:i/85) #reduce the RGB value of each channel, 255/3=85

    mark=Image.merge("RGB",waterMark)
    origin=Image.merge("RGB",image)

    result=ImageChops.add(mark,origin)

    return result,size

def deCode(waterMark,size):
    waterMark.load()
    source = waterMark.split()
    originSize=size 

    mark=[(),(),()]
    for x in [0,1,2]:
        mark[x]=source[x].point(lambda i:(i &amp; 0x3)*85) #get back the RGB value of the marked image

    result=Image.merge("RGB",mark)
    result = result.resize(originSize)

    return result

if __name__ == '__main__':
    img1,size = waterMark("avatar2.jpg","green.jpg")
    img2 = deCode(img1,size)

    img1.show() #original image with watermark
    img2.show() #embeded image
</code></pre>
]]></content>
  </entry>
  
</feed>
